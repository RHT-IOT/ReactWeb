(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{5782:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var n=s(5155),a=s(4689),o=s(2115);function l(e){let{data:t,onSave:s}=e;if(!t)return(0,n.jsx)("div",{children:"Loadingâ€¦"});let{email:a,Location:l,DevList:i}=t,[r,d]=(0,o.useState)(a.reduce((e,t)=>(e[t]={},e),{}));return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",gap:"24px"},children:[a.map(e=>(0,n.jsxs)("div",{style:{border:"1px solid #ccc",padding:12},children:[(0,n.jsx)("h3",{children:e}),l.map((t,a)=>(0,n.jsxs)("div",{style:{marginBottom:8},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("strong",{children:t}),(0,n.jsx)("button",{className:"brand-button button-outline",style:{padding:"2px 6px",fontSize:12},onClick:()=>{var s;return s=i[a]||[],void d(n=>{let a={...n[e]},o=new Set(a[t]||[]);for(let e of s)o.add(e);return a[t]=Array.from(o),{...n,[e]:a}})},disabled:0===(i[a]||[]).length,children:"Select All"}),(0,n.jsx)("button",{className:"brand-button button-outline",style:{padding:"2px 6px",fontSize:12},onClick:()=>((e,t)=>{let n={...r[e]};n[t]=[];let a={...r,[e]:n};delete a[e][t],d(a),s?s(a):console.log("Access cleared and saved:",a)})(e,t),children:"Clear"})]}),(0,n.jsx)("div",{style:{marginLeft:12},children:0===i[a].length?(0,n.jsx)("em",{children:"No devices"}):i[a].map(s=>{var a;return(0,n.jsxs)("label",{style:{display:"block"},children:[(0,n.jsx)("input",{type:"checkbox",checked:(null==(a=r[e][t])?void 0:a.includes(s))||!1,onChange:()=>{d(n=>{let a={...n[e]},o=new Set(a[t]||[]);return o.has(s)?o.delete(s):o.add(s),a[t]=Array.from(o),{...n,[e]:a}})}}),s]},s)})})]},t))]},e)),(0,n.jsx)("pre",{style:{flex:1,background:"#f9f9f9",padding:12},children:JSON.stringify(r,null,2)})]}),(0,n.jsx)("button",{className:"brand-button button-outline",onClick:()=>{s?s(r):console.log("Access state:",r)},style:{marginTop:16},children:"Save Access"})]})}function i(e){let{values:t,setValues:s}=e;return(0,n.jsxs)("table",{style:{borderCollapse:"collapse",width:"100%",border:"1px solid black"},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{border:"1px solid black",padding:"6px"},children:"DeviceID"}),(0,n.jsx)("th",{style:{border:"1px solid black",padding:"6px"},children:"Location"}),(0,n.jsx)("th",{style:{border:"1px solid black",padding:"6px"},children:"Coordinate (lat, long)"})]})}),(0,n.jsx)("tbody",{children:(0,n.jsx)("tr",{children:t.map((e,a)=>(0,n.jsx)("td",{style:{border:"1px solid black",padding:"6px"},children:(0,n.jsx)("textarea",{value:e,onChange:e=>((e,n)=>{let a=[...t];a[e]=n,s(a)})(a,e.target.value),rows:1,style:{backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",width:"100%"}})},a))})})]})}function r(e){let{devices:t}=e;return t&&0!==t.length?(0,n.jsxs)("table",{style:{borderCollapse:"collapse",width:"100%",border:"1px solid black"},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{border:"1px solid black",padding:"6px"},children:"DeviceID"}),(0,n.jsx)("th",{style:{border:"1px solid black",padding:"6px"},children:"Location"}),(0,n.jsx)("th",{style:{border:"1px solid black",padding:"6px"},children:"Coordinate"})]})}),(0,n.jsx)("tbody",{children:t.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{border:"1px solid black",padding:"6px"},children:e.DeviceID}),(0,n.jsx)("td",{style:{border:"1px solid black",padding:"6px"},children:e.Location}),(0,n.jsx)("td",{style:{border:"1px solid black",padding:"6px"},children:Array.isArray(e.Coordinate)?e.Coordinate.join(", "):e.Coordinate})]},t))})]}):(0,n.jsx)("pre",{children:"No data yet"})}function d(){var e;let t=(0,a.As)(),[s,d]=(0,o.useState)(),[c,p]=(0,o.useState)(),[h,x]=(0,o.useState)(["","",""]),u={Records:[{eventName:"REFRESH"}]},b=async()=>{var e;await fetch("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/showUserDevice",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null==(e=t.user)?void 0:e.id_token)}}).then(e=>e.json()).then(e=>{console.log("Raw API response:",e),p("string"==typeof e.body?JSON.parse(e.body):e.body)}).catch(e=>console.error(e))},y=async()=>{var e;(null==t||null==(e=t.user)?void 0:e.id_token)&&await fetch("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/getSensorBoxModel",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.user.id_token)}}).then(e=>e.json()).then(e=>{console.log("Raw API response:",e),d("string"==typeof e.body?JSON.parse(e.body):e.body)}).catch(e=>console.error(e))},j=async e=>{let s=[];for(let t of Object.keys(e||{})){let n=e[t]||{};for(let e of Object.keys(n)){let a=n[e]||[];a.length>0&&s.push({email:t,Location:e,DeviceRight:a})}}console.log("AddDevUser:",s);try{return await fetch("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/PutUserDevice",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.user.id_token)},body:JSON.stringify(s)})}catch(e){console.error("Failed to save user device rights:",e)}},g=async()=>{var e;let s={DeviceID:BigInt(h[0]),Location:h[1],Coordinate:h[2].split(", ").map(e=>parseFloat(e.trim()))};return console.log(s),await fetch("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/putSensorBoxModel",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null==(e=t.user)?void 0:e.id_token)},body:JSON.stringify(s)})};(0,o.useEffect)(()=>{if(t.isAuthenticated){var e;(null==(e=t.user)?void 0:e.profile.email)==="natsense00@gmail.com"?(console.log("correct user"),y(),b()):console.log("not ok")}},[t.isAuthenticated,null==(e=t.user)?void 0:e.profile.email]);let[m,v]=(0,o.useState)("");return(0,n.jsxs)("div",{className:"page-container",style:{paddingTop:24},children:[(0,n.jsxs)("div",{className:"brand-header",style:{display:"flex",alignItems:"center",padding:"8px 12px"},children:[(0,n.jsx)("span",{className:"brand-title",children:"Admin"}),(0,n.jsx)("button",{className:"brand-button button-outline",style:{marginLeft:"auto"},onClick:()=>window.location.replace("/login"),children:"Back to Dashboard"})]}),(0,n.jsxs)("div",{className:"panel",style:{marginTop:16},children:[(0,n.jsx)("div",{className:"section-title",children:"Refresh sdid and dsid"}),(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8},children:(0,n.jsx)("button",{className:"brand-button button-outline",onClick:()=>{var e;return fetch("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/Refresh",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null==(e=t.user)?void 0:e.id_token)},body:JSON.stringify(u)})},children:"Refresh"})})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"16px",marginTop:16},children:[(0,n.jsxs)("div",{className:"panel",style:{flex:1},children:[(0,n.jsx)("div",{className:"section-title",children:"SensorBoxTable"}),(0,n.jsx)(r,{devices:s})]}),(0,n.jsxs)("div",{className:"panel",style:{flex:1,gap:8},children:[(0,n.jsx)("div",{className:"section-title",children:"Latest Data Dashboard"}),(0,n.jsx)(i,{values:h,setValues:x}),(0,n.jsx)("button",{className:"brand-button button-outline",onClick:async()=>{await g(),await y()},style:{marginTop:16},children:"Add New IMEI Dev"})]})]}),(0,n.jsxs)("div",{className:"panel",style:{marginTop:16},children:[(0,n.jsx)("div",{className:"section-title",children:"Refresh DevUser"}),(0,n.jsx)("button",{className:"brand-button button-outline",onClick:b,children:"Refresh"}),(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:16},children:(0,n.jsx)(l,{data:c,onSave:j})})]})]})}BigInt.prototype.toJSON=function(){return this.toString()}},9847:(e,t,s)=>{Promise.resolve().then(s.bind(s,5782))}},e=>{e.O(0,[689,441,255,358],()=>e(e.s=9847)),_N_E=e.O()}]);