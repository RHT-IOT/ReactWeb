(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{2407:(e,t,a)=>{Promise.resolve().then(a.bind(a,9078))},3020:(e,t,a)=>{"use strict";async function n(e,t,a,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"POST",r=async a=>fetch(e,{method:s,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(t)}),i=await r(a);if((401===i.status||403===i.status)&&n)try{let e=await n();e&&(i=await r(e))}catch(e){}if(!i.ok){let t=Error("HTTP ".concat(i.status));t.status=i.status,t.url=e;try{t.body=await i.text()}catch(e){}throw t}return i}async function s(e,t,a){let s=await n("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/getIMEI",{email:e},t,a),r=await s.json(),i={};try{var l;i=JSON.parse(null!=(l=null==r?void 0:r.body)?l:"{}")}catch(e){console.error("getIMEIList JSON parse error",e)}let o=Array.isArray(null==i?void 0:i.items)?i.items:[],c=Array.isArray(null==i?void 0:i.dev_access)?i.dev_access:[];return{items:o.filter(e=>Array.isArray(e.Coordinate)&&2===e.Coordinate.length),dev_access:c.map(e=>Array.isArray(e)?e.map(String):[])}}async function r(e,t,a){var s;let r=await n("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/getLatestDP",{IMEI:e},t,a),i=JSON.parse(null!=(s=(await r.json()).body)?s:"[]"),l={},o={},c=0;for(let e of i)o[c]=e.DeviceType,l[e.DeviceType]=e,c++;return{deviceMap:l,deviceTypes:o}}async function i(e,t,a,s,r,i){var l;let o=await n("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/getDpFromTime",{IMEI:e,startDateTime:t,endDateTime:a,timeInterval:r},s,i),c=JSON.parse(null!=(l=(await o.json()).body)?l:"{}");return{deviceTypes:c.deviceTypes||[],items:c.items||[]}}function l(e){let{IMEI:t,idToken:a,getIdToken:n,intervalMs:s=3e5,callback:i}=e,l=null,o=a;async function c(){try{let e;try{e=await r(t,o)}catch(a){if(((null==a?void 0:a.status)===401||(null==a?void 0:a.status)===403)&&n)try{let s=await n();if(s)o=s,e=await r(t,o);else throw a}catch(e){throw null!=e?e:a}else throw a}i(e)}catch(e){console.error("Poller tick failed:",e)}}return{async start(){await c(),l&&window.clearInterval(l),l=window.setInterval(c,s)},stop(){l&&(window.clearInterval(l),l=null)}}}a.d(t,{A5:()=>r,I:()=>i,W4:()=>l,bC:()=>s})},9078:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var n=a(5155),s=a(4689),r=a(2115),i=a(3020);function l(){var e,t,a;let l=(0,s.As)();(0,r.useEffect)(()=>{let e=localStorage.getItem("theme-name"),t=localStorage.getItem("mode-name"),a=document.body.classList;a.remove("theme-a","theme-b","theme-c","mode-light","mode-dark"),a.add(e||"theme-a"),a.add(t||"mode-light")},[]);let[o,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(""),[h,p]=(0,r.useState)([]),[y,m]=(0,r.useState)({}),[v,f]=(0,r.useState)(""),[g,w]=(0,r.useState)({}),[b,S]=(0,r.useState)({}),[j,x]=(0,r.useState)(!1),N=(0,r.useMemo)(()=>{let e=g[String(d)]||[];return e.length>0?e:Array.from(new Set(h.map(e=>"string"==typeof e&&e.includes("/")?e.split("/")[0]:"").filter(Boolean)))},[g,d,h]),A=(0,r.useMemo)(()=>v?h.filter(e=>"string"==typeof e&&e.startsWith(v+"/")).map(e=>e.split("/")[1]||e):[],[h,v]);async function I(){var e,t,a,n,s;if((null==l?void 0:l.isAuthenticated)&&(null==(e=l.user)?void 0:e.id_token)&&(null==(a=l.user)||null==(t=a.profile)?void 0:t.email))try{let e=await (0,i.bC)(l.user.profile.email,l.user.id_token),t=Array.isArray(e.items)?e.items:[],a=Array.isArray(e.dev_access)?e.dev_access:[],r={};t.forEach((e,t)=>{let n=Array.isArray(a[t])?a[t].map(String):[];r[String(e.DeviceID)]=n}),w(r),c(t);let o=String((null==t||null==(n=t[0])?void 0:n.DeviceID)||"");u(o);let d=r[String(null==t||null==(s=t[0])?void 0:s.DeviceID)]||[];f(d[0]||""),o&&await C(o)}catch(e){console.error("loadIMEIs error",e)}}async function k(e){var t;if(e&&(null==l||null==(t=l.user)?void 0:t.id_token))try{let t=await (0,i.A5)(e,l.user.id_token);S(t.deviceMap||{})}catch(e){console.error("getLatestDP error",e)}}async function C(e){var t;if(e&&(null==l||null==(t=l.user)?void 0:t.id_token))try{let t=await a("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/getCPname",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l.user.id_token)},body:JSON.stringify({IMEI:Number(e)})}),n=await t.json(),s="string"==typeof n.body?JSON.parse(n.body):n.body,r=Array.isArray(null==s?void 0:s.items)?s.items.map(String):Array.isArray(s)?s.map(String):Array.isArray(null==s?void 0:s.nameList)?s.nameList.map(String):[];p(r),m(r.reduce((e,t)=>{var a;return e[t]=null!=(a=e[t])?a:"",e},{})),await k(e)}catch(e){console.error("fetchCPNames error",e)}async function a(e,t){let a=await fetch(e,t);if(401===a.status||403===a.status)try{let s=null==l?void 0:l.signinSilent;if("function"==typeof s){var n;let r=await s(),i=null!=(n=null==r?void 0:r.id_token)?n:l.user.id_token,o={...t,headers:{...t.headers||{},Authorization:"Bearer ".concat(i)}};a=await fetch(e,o)}}catch(e){}return a}}async function _(e,t){var a;if(!(null==l||null==(a=l.user)?void 0:a.id_token)||!d)return;let n=(Array.isArray(t)?t:[t]).map(t=>{var a;let n="".concat(e,"/").concat(String(t)),s=null!=(a=y[n])?a:"";return[n,s]});try{let e=await D("https://6ts7sjoaw6.execute-api.ap-southeast-2.amazonaws.com/test/setCPvalue",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l.user.id_token)},body:JSON.stringify({IMEI:Number(d),DevDpValue:n})});e.ok||console.error("setCPvalue failed",await e.text())}catch(e){console.error("setCPvalue error",e)}}async function D(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3,s=null;for(let r=0;r<=a;r++){try{let n=await fetch(e,t);if(n.ok||r===a)return n}catch(e){if(s=e,r===a)throw e}await new Promise(e=>setTimeout(e,n*(r+1)))}throw null!=s?s:Error("authFetchRetry failed")}async function E(){if(console.log("sendAll:",A),v&&0!==A.length){x(!0);try{await _(v,A)}catch(e){console.error("sendAll error",e)}finally{x(!1)}}}return(0,r.useEffect)(()=>{I()},[l.isAuthenticated,null==(e=l.user)?void 0:e.id_token,null==(a=l.user)||null==(t=a.profile)?void 0:t.email]),(0,r.useEffect)(()=>{!v&&N.length>0&&f(N[0])},[N,v]),(0,r.useEffect)(()=>{if(!v||!b||0===A.length)return;let e=b[v];e&&m(t=>{let a={...t};return A.forEach(n=>{let s="".concat(v,"/").concat(n),r=e[n];void 0!==r&&(void 0===t[s]||""===t[s])&&(a[s]=String(r))}),a})},[b,v,A]),(0,n.jsxs)("div",{className:"page-container",style:{paddingTop:24},children:[(0,n.jsxs)("div",{className:"brand-header",style:{display:"flex",alignItems:"center",padding:"8px 12px"},children:[(0,n.jsx)("span",{className:"brand-title",children:"Control Panel"}),(0,n.jsx)("button",{className:"brand-button button-outline",style:{marginLeft:"auto"},onClick:()=>window.location.replace("/login"),children:"Back to Dashboard"})]}),(0,n.jsxs)("div",{className:"panel",style:{marginTop:16},children:[(0,n.jsx)("div",{className:"section-title",children:"Select IMEI"}),(0,n.jsxs)("div",{className:"control-row",style:{gap:8},children:[(0,n.jsx)("select",{className:"brand-select",value:d,onChange:e=>{let t=e.target.value;u(t),C(t)},children:o.map((e,t)=>(0,n.jsx)("option",{value:String(e.DeviceID),children:e.Location||String(e.DeviceID)},t))}),(0,n.jsx)("button",{className:"brand-button",onClick:()=>C(d),disabled:!d,children:"Load Names"})]})]}),(0,n.jsxs)("div",{className:"panel",style:{marginTop:16},children:[(0,n.jsx)("div",{className:"section-title",children:"Select Device"}),(0,n.jsx)("div",{className:"control-row",style:{gap:8},children:(0,n.jsx)("select",{className:"brand-select",value:v,onChange:e=>f(e.target.value),children:N.map((e,t)=>(0,n.jsx)("option",{value:e,children:e},t))})})]}),(0,n.jsxs)("div",{className:"panel",style:{marginTop:16},children:[(0,n.jsxs)("div",{className:"section-title",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)("span",{children:"Gauge Grid (Datatype + Input)"}),(0,n.jsx)("button",{className:"brand-button button-outline",onClick:E,disabled:!v||0===A.length||j,children:j?"Sending...":"Send All"})]}),v&&0!==A.length?(0,n.jsx)("div",{className:"dashboard-grid",style:{gap:16},children:A.map((e,t)=>{let a="".concat(v,"/").concat(e);return(0,n.jsxs)("div",{className:"panel",style:{padding:12},children:[(0,n.jsx)("div",{className:"section-title",style:{marginBottom:8},children:e}),(0,n.jsxs)("div",{className:"control-row",style:{gap:8},children:[(0,n.jsx)("input",{type:"text",className:"brand-input",placeholder:"Enter value",value:y[a]||"",onChange:e=>{var t;return t=e.target.value,void m(e=>({...e,[a]:t}))}}),(0,n.jsx)("button",{className:"brand-button",onClick:()=>_(v,e),children:"Send"})]})]},t)})}):(0,n.jsxs)("pre",{children:["No datatypes for device ",v||"-"," (IMEI ",d||"-",")."]})]})]})}}},e=>{e.O(0,[689,441,255,358],()=>e(e.s=2407)),_N_E=e.O()}]);